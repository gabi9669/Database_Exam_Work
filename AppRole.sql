USE [vizsga]
GO


IF NOT EXISTS
    (SELECT name
     FROM sys.database_principals
     WHERE name = 'AppRole')
BEGIN
CREATE APPLICATION ROLE [AppRole] WITH DEFAULT_SCHEMA = [Customer], PASSWORD = N'AppRole2021'
GRANT ALTER ON SCHEMA::[Customer] TO [AppRole]
GRANT CONTROL ON SCHEMA::[Customer] TO [AppRole]
GRANT CREATE SEQUENCE ON SCHEMA::[Customer] TO [AppRole]
GRANT DELETE ON SCHEMA::[Customer] TO [AppRole]
GRANT EXECUTE ON SCHEMA::[Customer] TO [AppRole]
GRANT INSERT ON SCHEMA::[Customer] TO [AppRole]
GRANT REFERENCES ON SCHEMA::[Customer] TO [AppRole]
GRANT SELECT ON SCHEMA::[Customer] TO [AppRole]
GRANT UPDATE ON SCHEMA::[Customer] TO [AppRole]
GRANT VIEW CHANGE TRACKING ON SCHEMA::[Customer] TO [AppRole]
GRANT VIEW DEFINITION ON SCHEMA::[Customer] TO [AppRole]
DENY TAKE OWNERSHIP ON SCHEMA::[Customer] TO [AppRole]
GRANT ALTER ON SCHEMA::[Orders] TO [AppRole]
GRANT CONTROL ON SCHEMA::[Orders] TO [AppRole]
GRANT CREATE SEQUENCE ON SCHEMA::[Orders] TO [AppRole]
GRANT DELETE ON SCHEMA::[Orders] TO [AppRole]
GRANT EXECUTE ON SCHEMA::[Orders] TO [AppRole]
GRANT INSERT ON SCHEMA::[Orders] TO [AppRole]
GRANT REFERENCES ON SCHEMA::[Orders] TO [AppRole]
GRANT SELECT ON SCHEMA::[Orders] TO [AppRole]
GRANT UPDATE ON SCHEMA::[Orders] TO [AppRole]
GRANT VIEW CHANGE TRACKING ON SCHEMA::[Orders] TO [AppRole]
GRANT VIEW DEFINITION ON SCHEMA::[Orders] TO [AppRole]
DENY TAKE OWNERSHIP ON SCHEMA::[Orders] TO [AppRole]
GRANT ALTER ON SCHEMA::[Product] TO [AppRole]
GRANT CONTROL ON SCHEMA::[Product] TO [AppRole]
GRANT CREATE SEQUENCE ON SCHEMA::[Product] TO [AppRole]
GRANT DELETE ON SCHEMA::[Product] TO [AppRole]
GRANT EXECUTE ON SCHEMA::[Product] TO [AppRole]
GRANT INSERT ON SCHEMA::[Product] TO [AppRole]
GRANT REFERENCES ON SCHEMA::[Product] TO [AppRole]
GRANT SELECT ON SCHEMA::[Product] TO [AppRole]
GRANT UPDATE ON SCHEMA::[Product] TO [AppRole]
GRANT VIEW CHANGE TRACKING ON SCHEMA::[Product] TO [AppRole]
GRANT VIEW DEFINITION ON SCHEMA::[Product] TO [AppRole]
DENY TAKE OWNERSHIP ON SCHEMA::[Product] TO [AppRole]
PRINT 'AppRole Created'
END
ELSE
BEGIN
DROP APPLICATION ROLE [AppRole]

CREATE APPLICATION ROLE [AppRole] WITH DEFAULT_SCHEMA = [Customer], PASSWORD = N'AppRole2021'
GRANT ALTER ON SCHEMA::[Customer] TO [AppRole]
GRANT CONTROL ON SCHEMA::[Customer] TO [AppRole]
GRANT CREATE SEQUENCE ON SCHEMA::[Customer] TO [AppRole]
GRANT DELETE ON SCHEMA::[Customer] TO [AppRole]
GRANT EXECUTE ON SCHEMA::[Customer] TO [AppRole]
GRANT INSERT ON SCHEMA::[Customer] TO [AppRole]
GRANT REFERENCES ON SCHEMA::[Customer] TO [AppRole]
GRANT SELECT ON SCHEMA::[Customer] TO [AppRole]
GRANT UPDATE ON SCHEMA::[Customer] TO [AppRole]
GRANT VIEW CHANGE TRACKING ON SCHEMA::[Customer] TO [AppRole]
GRANT VIEW DEFINITION ON SCHEMA::[Customer] TO [AppRole]
DENY TAKE OWNERSHIP ON SCHEMA::[Customer] TO [AppRole]
GRANT ALTER ON SCHEMA::[Orders] TO [AppRole]
GRANT CONTROL ON SCHEMA::[Orders] TO [AppRole]
GRANT CREATE SEQUENCE ON SCHEMA::[Orders] TO [AppRole]
GRANT DELETE ON SCHEMA::[Orders] TO [AppRole]
GRANT EXECUTE ON SCHEMA::[Orders] TO [AppRole]
GRANT INSERT ON SCHEMA::[Orders] TO [AppRole]
GRANT REFERENCES ON SCHEMA::[Orders] TO [AppRole]
GRANT SELECT ON SCHEMA::[Orders] TO [AppRole]
GRANT UPDATE ON SCHEMA::[Orders] TO [AppRole]
GRANT VIEW CHANGE TRACKING ON SCHEMA::[Orders] TO [AppRole]
GRANT VIEW DEFINITION ON SCHEMA::[Orders] TO [AppRole]
DENY TAKE OWNERSHIP ON SCHEMA::[Orders] TO [AppRole]
GRANT ALTER ON SCHEMA::[Product] TO [AppRole]
GRANT CONTROL ON SCHEMA::[Product] TO [AppRole]
GRANT CREATE SEQUENCE ON SCHEMA::[Product] TO [AppRole]
GRANT DELETE ON SCHEMA::[Product] TO [AppRole]
GRANT EXECUTE ON SCHEMA::[Product] TO [AppRole]
GRANT INSERT ON SCHEMA::[Product] TO [AppRole]
GRANT REFERENCES ON SCHEMA::[Product] TO [AppRole]
GRANT SELECT ON SCHEMA::[Product] TO [AppRole]
GRANT UPDATE ON SCHEMA::[Product] TO [AppRole]
GRANT VIEW CHANGE TRACKING ON SCHEMA::[Product] TO [AppRole]
GRANT VIEW DEFINITION ON SCHEMA::[Product] TO [AppRole]
DENY TAKE OWNERSHIP ON SCHEMA::[Product] TO [AppRole]
PRINT 'AppRole Recreated'
END
